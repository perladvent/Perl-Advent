<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <meta http-equiv="Content-Language" content="en" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="WWW::AdventCalendar v1.112" />
    <link rel="alternate" title="Perl Advent Calendar 2015 XML feed" href="atom.xml" type="application/atom+xml" />
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="stylesheet" href="style.css" type="text/css" />
    <link rel="stylesheet" href="2015.css" type="text/css" />
    <title>
Perl Advent Calendar 2015 - 
Winter Platypus

</title>
</head>
<body>
    <div id="contentwrapper">
        <div id="header">
            <h1><a href="index.html">Perl Advent Calendar 2015</a></h1>
        </div>

        <p id="tagline">2015 twenty four merry days of Perl
         <a class='feed' href="atom.xml">Feed</a>
        </p>

        <div id="content">
          

<h1 class='title'>Winter Platypus</h1>
<div class='subtitle'>FFI::Platypus - 2015-12-03</div>

<div class='pod'><p>The boss (Mr. Claus) asked me to whip up some decorations for the Christmas party, and since this is a modern outfit (as you know we have the the largest toy and child database in the world), cutting some paper snowflakes just wasn&#39;t going to impress.</p>

<center><img src="screenshot800.png"/></center>

<p>I decided to write a little Perl program to render these three dimensional snowflakes and make them spin around on screen.</p>

<h3 id="Roles">Roles</h3>

<p>The first step was to create a class that represented a snowflake, and knew how to draw it. As the rendering of the snowflake is distinct from the actual attributes of the snowflake itself, I decided to create separate roles for the model and drawing code and combine these together in the end into one concrete snowflake class.</p>

<p>So, starting with a model to represent the physical characteristics of each snowflake, using a Moose role:</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;<br />7:&nbsp;<br />8:&nbsp;<br />9:&nbsp;<br />10:&nbsp;<br />11:&nbsp;<br />12:&nbsp;<br />13:&nbsp;<br />14:&nbsp;<br />15:&nbsp;<br />16:&nbsp;<br />17:&nbsp;<br />18:&nbsp;<br />19:&nbsp;<br />20:&nbsp;<br />21:&nbsp;<br />22:&nbsp;<br />23:&nbsp;<br />24:&nbsp;<br />25:&nbsp;<br />26:&nbsp;<br />27:&nbsp;<br />28:&nbsp;<br />29:&nbsp;<br />30:&nbsp;<br />31:&nbsp;<br />32:&nbsp;<br />33:&nbsp;<br />34:&nbsp;<br />35:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="keyword">package</span> <span class="word">SnowflakeModel</span><span class="structure">;</span><br /><br /><span class="keyword">use</span> <span class="word">Moose::Role</span><span class="structure">;</span><br />&nbsp;&nbsp;<br /><span class="word">has</span> <span class="word">num_twigs</span> <span class="operator">=&gt;</span> <span class="structure">(</span><br />&nbsp;&nbsp;<span class="word">is</span> <span class="operator">=&gt;</span> <span class="single">'ro'</span><span class="operator">,</span> <br />&nbsp;&nbsp;<span class="word">isa</span> <span class="operator">=&gt;</span> <span class="single">'Num'</span><span class="operator">,</span> <br />&nbsp;&nbsp;<span class="word">default</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span> <span class="structure">{</span> <span class="word">int</span><span class="structure">(</span><span class="word">rand</span> <span class="number">4</span><span class="structure">)</span> <span class="operator">+</span> <span class="number">3</span> <span class="structure">}</span><span class="operator">,</span><br /><span class="structure">);</span><br /><br /><span class="word">has</span> <span class="word">pinkie_length</span> <span class="operator">=&gt;</span> <span class="structure">(</span><br />&nbsp;&nbsp;<span class="word">is</span> <span class="operator">=&gt;</span> <span class="single">'ro'</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">isa</span> <span class="operator">=&gt;</span> <span class="single">'Num'</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">default</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span> <span class="structure">{</span> <span class="float">0.5</span> <span class="operator">+</span> <span class="structure">(</span><span class="word">rand</span><span class="structure">)</span><span class="operator">/</span><span class="float">2.0</span> <span class="structure">}</span><br /><span class="structure">);</span><br /><br /><span class="word">has</span> <span class="word">branch_length</span> <span class="operator">=&gt;</span> <span class="structure">(</span><br />&nbsp;&nbsp;<span class="word">is</span> <span class="operator">=&gt;</span> <span class="single">'ro'</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">isa</span> <span class="operator">=&gt;</span> <span class="single">'Num'</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">default</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span> <span class="structure">{</span> <span class="float">1.0</span> <span class="operator">+</span> <span class="structure">(</span><span class="word">rand</span><span class="structure">)</span> <span class="structure">}</span><span class="operator">,</span><br /><span class="structure">);</span><br />&nbsp;&nbsp;<br /><span class="word">has</span> <span class="word">segments</span> <span class="operator">=&gt;</span> <span class="structure">(</span><br />&nbsp;&nbsp;<span class="word">is</span> <span class="operator">=&gt;</span> <span class="single">'ro'</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">isa</span> <span class="operator">=&gt;</span> <span class="single">'Int'</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">default</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span> <span class="structure">{</span> <span class="word">int</span><span class="structure">(</span><span class="word">rand</span> <span class="number">4</span><span class="structure">)</span> <span class="operator">+</span> <span class="number">2</span> <span class="structure">}</span><span class="operator">,</span><br /><span class="structure">);</span><br />&nbsp;&nbsp;<br /><span class="word">has</span> <span class="magic">$_</span> <span class="operator">=&gt;</span> <span class="structure">(</span><span class="word">is</span> <span class="operator">=&gt;</span> <span class="single">'rw'</span><span class="operator">,</span> <span class="word">isa</span> <span class="operator">=&gt;</span> <span class="single">'Num'</span><span class="operator">,</span> <span class="word">default</span> <span class="operator">=&gt;</span> <span class="float">0.0</span> <span class="structure">)</span><br />&nbsp;&nbsp;<span class="word">for</span> <span class="words">qw( x y z )</span><span class="structure">;</span><br />&nbsp;&nbsp;<br /><span class="word">has</span> <span class="magic">$_</span> <span class="operator">=&gt;</span> <span class="structure">(</span><span class="word">is</span> <span class="operator">=&gt;</span> <span class="single">'rw'</span><span class="operator">,</span> <span class="word">isa</span> <span class="operator">=&gt;</span> <span class="single">'Num'</span><span class="operator">,</span> <span class="word">default</span> <span class="operator">=&gt;</span> <span class="float">0.0</span> <span class="structure">)</span><br />&nbsp;&nbsp;<span class="word">for</span> <span class="words">qw( xspin yspin zspin )</span><span class="structure">;</span><br /><br /><span class="number">1</span><span class="structure">;</span></code><br />&nbsp;</td></table>

<p>The model keeps track of the number of branches, and twigs (it would be the &quot;leaf&quot; node, but this being a winter party the leaves have obviously fallen).</p>

<p>The next step was to write some code to draw the snowflake. After some tweaking, I decided on a recursive algorithm using OpenGL.</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;<br />7:&nbsp;<br />8:&nbsp;<br />9:&nbsp;<br />10:&nbsp;<br />11:&nbsp;<br />12:&nbsp;<br />13:&nbsp;<br />14:&nbsp;<br />15:&nbsp;<br />16:&nbsp;<br />17:&nbsp;<br />18:&nbsp;<br />19:&nbsp;<br />20:&nbsp;<br />21:&nbsp;<br />22:&nbsp;<br />23:&nbsp;<br />24:&nbsp;<br />25:&nbsp;<br />26:&nbsp;<br />27:&nbsp;<br />28:&nbsp;<br />29:&nbsp;<br />30:&nbsp;<br />31:&nbsp;<br />32:&nbsp;<br />33:&nbsp;<br />34:&nbsp;<br />35:&nbsp;<br />36:&nbsp;<br />37:&nbsp;<br />38:&nbsp;<br />39:&nbsp;<br />40:&nbsp;<br />41:&nbsp;<br />42:&nbsp;<br />43:&nbsp;<br />44:&nbsp;<br />45:&nbsp;<br />46:&nbsp;<br />47:&nbsp;<br />48:&nbsp;<br />49:&nbsp;<br />50:&nbsp;<br />51:&nbsp;<br />52:&nbsp;<br />53:&nbsp;<br />54:&nbsp;<br />55:&nbsp;<br />56:&nbsp;<br />57:&nbsp;<br />58:&nbsp;<br />59:&nbsp;<br />60:&nbsp;<br />61:&nbsp;<br />62:&nbsp;<br />63:&nbsp;<br />64:&nbsp;<br />65:&nbsp;<br />66:&nbsp;<br />67:&nbsp;<br />68:&nbsp;<br />69:&nbsp;<br />70:&nbsp;<br />71:&nbsp;<br />72:&nbsp;<br />73:&nbsp;<br />74:&nbsp;<br />75:&nbsp;<br />76:&nbsp;<br />77:&nbsp;<br />78:&nbsp;<br />79:&nbsp;<br />80:&nbsp;<br />81:&nbsp;<br />82:&nbsp;<br />83:&nbsp;<br />84:&nbsp;<br />85:&nbsp;<br />86:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="keyword">package</span> <span class="word">SnowflakeDraw</span><span class="structure">;</span><br /><br /><span class="keyword">use</span> <span class="float">5.010</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="word">Moose::Role</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="word">GL</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="word">GLUT</span><span class="structure">;</span><br />&nbsp;&nbsp;<br /><span class="word">requires</span> <span class="words">qw( <br />&nbsp;&nbsp;num_twigs pinkie_length branch_length segments<br />&nbsp;&nbsp;x y z xspin yspin zspin<br />)</span><span class="structure">;</span><br />&nbsp;&nbsp;<br /><span class="keyword">sub</span> <span class="word">draw_twig</span> <span class="structure">{</span><br />&nbsp;&nbsp;<span class="keyword">my</span><span class="structure">(</span><span class="symbol">$self</span><span class="operator">,</span> <span class="symbol">$base</span><span class="operator">,</span> <span class="symbol">$height</span><span class="operator">,</span> <span class="symbol">$sides</span><span class="structure">)</span> <span class="operator">=</span> <span class="magic">@_</span><span class="structure">;</span><br />&nbsp;&nbsp;<span class="word">glPushMatrix</span><span class="structure">();</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">glRotated</span><span class="structure">(</span><span class="float">-90.0</span><span class="operator">,</span> <span class="float">1.0</span><span class="operator">,</span> <span class="float">0.0</span><span class="operator">,</span> <span class="float">0.0</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">glutSolidCone</span><span class="structure">(</span><span class="symbol">$base</span><span class="operator">,</span> <span class="symbol">$height</span><span class="operator">,</span> <span class="symbol">$sides</span><span class="operator">,</span> <span class="number">5</span><span class="structure">);</span><br />&nbsp;&nbsp;<span class="word">glPopMatrix</span><span class="structure">();</span><br /><span class="structure">}</span><br />&nbsp;&nbsp;<br /><span class="keyword">sub</span> <span class="word">draw_branch</span> <span class="structure">{</span><br />&nbsp;&nbsp;<span class="keyword">my</span><span class="structure">(</span><span class="symbol">$self</span><span class="operator">,</span> <span class="symbol">$size</span><span class="operator">,</span> <span class="symbol">$left</span><span class="operator">,</span> <span class="symbol">$segments</span><span class="structure">)</span> <span class="operator">=</span> <span class="magic">@_</span><span class="structure">;</span><br />&nbsp;&nbsp;<span class="symbol">$segments</span> <span class="operator">//=</span> <span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">segments</span><span class="structure">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;<span class="word">glPushMatrix</span><span class="structure">();</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">glPushMatrix</span><span class="structure">();</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">glRotated</span><span class="structure">(</span><span class="number">30</span><span class="operator">,</span> <span class="float">0.0</span><span class="operator">,</span> <span class="float">0.0</span><span class="operator">,</span> <span class="float">1.0</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">draw_branch</span><span class="structure">(</span><span class="symbol">$size</span><span class="operator">/</span><span class="float">1.5</span><span class="operator">,</span> <span class="symbol">$size</span><span class="operator">,</span> <span class="word">int</span><span class="structure">(</span><span class="symbol">$segments</span><span class="operator">/</span><span class="number">2</span><span class="structure">))</span> <span class="word">if</span> <span class="symbol">$segments</span> <span class="operator">&gt;</span> <span class="number">1</span><span class="structure">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">draw_twig</span><span class="structure">(</span><span class="float">0.025</span><span class="operator">,</span> <span class="symbol">$size</span><span class="operator">,</span> <span class="number">6</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">glRotated</span><span class="structure">(</span><span class="number">-60</span><span class="operator">,</span> <span class="float">0.0</span><span class="operator">,</span> <span class="float">0.0</span><span class="operator">,</span> <span class="float">1.0</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">draw_branch</span><span class="structure">(</span><span class="symbol">$size</span><span class="operator">/</span><span class="float">1.5</span><span class="operator">,</span> <span class="symbol">$size</span><span class="operator">,</span> <span class="word">int</span><span class="structure">(</span><span class="symbol">$segments</span><span class="operator">/</span><span class="number">2</span><span class="structure">))</span> <span class="word">if</span> <span class="symbol">$segments</span> <span class="operator">&gt;</span> <span class="number">1</span><span class="structure">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">draw_twig</span><span class="structure">(</span><span class="float">0.025</span><span class="operator">,</span> <span class="symbol">$size</span><span class="operator">,</span> <span class="number">6</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">glPopMatrix</span><span class="structure">();</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">glTranslated</span><span class="structure">(</span><span class="float">0.0</span><span class="operator">,</span> <span class="symbol">$left</span><span class="operator">/</span><span class="structure">(</span><span class="symbol">$segments</span><span class="operator">*</span><span class="float">.75</span><span class="structure">)</span><span class="operator">,</span> <span class="float">0.0</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">draw_branch</span><span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$size</span> <span class="operator">/</span> <span class="float">1.5</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$left</span><span class="operator">-</span><span class="symbol">$left</span><span class="operator">/</span><span class="structure">(</span><span class="symbol">$segments</span><span class="operator">*</span><span class="float">.75</span><span class="structure">)</span><span class="operator">,</span> <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">int</span><span class="structure">(</span><span class="symbol">$segments</span><span class="operator">-</span><span class="number">1</span><span class="structure">)</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">)</span> <span class="word">if</span> <span class="symbol">$segments</span> <span class="operator">&gt;</span> <span class="number">1</span><span class="structure">;</span><br />&nbsp;&nbsp;<span class="word">glPopMatrix</span><span class="structure">();</span><br /><span class="structure">}</span><br /><br /><span class="keyword">sub</span> <span class="word">draw</span> <span class="structure">{</span><br />&nbsp;&nbsp;<span class="keyword">my</span><span class="structure">(</span><span class="symbol">$self</span><span class="structure">)</span> <span class="operator">=</span> <span class="magic">@_</span><span class="structure">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;<span class="word">glPushMatrix</span><span class="structure">();</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">glTranslated</span><span class="structure">(</span><span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">x</span><span class="operator">,</span> <span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">y</span><span class="operator">,</span> <span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">z</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">glRotated</span><span class="structure">(</span><span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">xspin</span><span class="operator">,</span> <span class="float">1.0</span><span class="operator">,</span> <span class="float">0.0</span><span class="operator">,</span> <span class="float">0.0</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">glRotated</span><span class="structure">(</span><span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">yspin</span><span class="operator">,</span> <span class="float">0.0</span><span class="operator">,</span> <span class="float">1.0</span><span class="operator">,</span> <span class="float">0.0</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">glRotated</span><span class="structure">(</span><span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">zspin</span><span class="operator">,</span> <span class="float">0.0</span><span class="operator">,</span> <span class="float">0.0</span><span class="operator">,</span> <span class="float">1.0</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">glEnable</span><span class="structure">(</span><span class="word">GL_COLOR_MATERIAL</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">glEnable</span><span class="structure">(</span><span class="word">GL_BLEND</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">glColor4d</span><span class="structure">(</span><span class="float">0.60</span><span class="operator">,</span> <span class="float">0.86</span><span class="operator">,</span> <span class="float">1.0</span><span class="operator">,</span> <span class="float">0.35</span><span class="structure">);</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span><span class="structure">(</span><span class="number">1</span><span class="operator">..</span><span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">num_twigs</span><span class="structure">)</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">glPushMatrix</span><span class="structure">();</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">glRotated</span><span class="structure">(</span><span class="number">360</span><span class="operator">/</span><span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">num_twigs</span><span class="operator">*</span><span class="structure">(</span><span class="magic">$_</span><span class="operator">-</span><span class="number">1</span><span class="structure">)</span><span class="operator">,</span> <span class="float">0.0</span><span class="operator">,</span> <span class="float">0.0</span><span class="operator">,</span> <span class="float">1.0</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">draw_branch</span><span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">pinkie_length</span><span class="operator">/</span><span class="float">1.25</span><span class="operator">,</span> <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">branch_length</span><span class="operator">/</span><span class="float">1.25</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">draw_twig</span><span class="structure">(</span><span class="float">0.05</span><span class="operator">,</span> <span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">branch_length</span><span class="operator">/</span><span class="float">1.25</span><span class="operator">,</span> <span class="number">12</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">glPopMatrix</span><span class="structure">();</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">glPushMatrix</span><span class="structure">();</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">glRotated</span><span class="structure">(</span><span class="number">90</span><span class="operator">,</span> <span class="float">1.0</span><span class="operator">,</span> <span class="float">0.0</span><span class="operator">,</span> <span class="float">0.0</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">draw_branch</span><span class="structure">(</span><span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">pinkie_length</span><span class="operator">/</span><span class="float">1.25</span><span class="operator">,</span> <span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">branch_length</span><span class="operator">/</span><span class="float">1.25</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">glRotated</span><span class="structure">(</span><span class="number">90</span><span class="operator">,</span> <span class="float">0.0</span><span class="operator">,</span> <span class="float">1.0</span><span class="operator">,</span> <span class="float">0.0</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">draw_branch</span><span class="structure">(</span><span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">pinkie_length</span><span class="operator">/</span><span class="float">1.25</span><span class="operator">,</span> <span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">branch_length</span><span class="operator">/</span><span class="float">1.25</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">draw_twig</span><span class="structure">(</span><span class="float">0.05</span><span class="operator">,</span> <span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">branch_length</span><span class="operator">/</span><span class="float">1.25</span><span class="operator">,</span> <span class="number">12</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">glRotated</span><span class="structure">(</span><span class="number">-180</span><span class="operator">,</span> <span class="float">1.0</span><span class="operator">,</span> <span class="float">0.0</span><span class="operator">,</span> <span class="float">0.0</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">draw_branch</span><span class="structure">(</span><span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">pinkie_length</span><span class="operator">/</span><span class="float">1.25</span><span class="operator">,</span> <span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">branch_length</span><span class="operator">/</span><span class="float">1.25</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">glRotated</span><span class="structure">(</span><span class="number">90</span><span class="operator">,</span> <span class="float">0.0</span><span class="operator">,</span> <span class="float">1.0</span><span class="operator">,</span> <span class="float">0.0</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">draw_branch</span><span class="structure">(</span><span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">pinkie_length</span><span class="operator">/</span><span class="float">1.25</span><span class="operator">,</span> <span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">branch_length</span><span class="operator">/</span><span class="float">1.25</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">draw_twig</span><span class="structure">(</span><span class="float">0.05</span><span class="operator">,</span> <span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">branch_length</span><span class="operator">/</span><span class="float">1.25</span><span class="operator">,</span> <span class="number">12</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">glPopMatrix</span><span class="structure">();</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">glDisable</span><span class="structure">(</span><span class="word">GL_BLEND</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">glDisable</span><span class="structure">(</span><span class="word">GL_COLOR_MATERIAL</span><span class="structure">);</span><br />&nbsp;&nbsp;<span class="word">glPopMatrix</span><span class="structure">();</span><br /><span class="structure">}</span><br /><br /><span class="number">1</span><span class="structure">;</span></code><br />&nbsp;</td></table>

<p>OpenGL is a portable API for drawing 3D graphics with fancy effects. Now I can combine the model and the draw logic into a single Moose class.</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;<br />7:&nbsp;<br />8:&nbsp;<br />9:&nbsp;<br />10:&nbsp;<br />11:&nbsp;<br />12:&nbsp;<br />13:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="keyword">package</span> <span class="word">Snowflake</span><span class="structure">;</span><br /><br /><span class="keyword">use</span> <span class="word">Moose</span><span class="structure">;</span><br /><span class="word">with</span> <span class="structure">(</span><span class="single">'SnowflakeModel'</span><span class="operator">,</span> <span class="single">'SnowflakeDraw'</span><span class="structure">);</span><br /><br /><span class="keyword">sub</span> <span class="word">spin</span> <span class="structure">{</span><br />&nbsp;&nbsp;<span class="keyword">my</span><span class="structure">(</span><span class="symbol">$self</span><span class="operator">,</span> <span class="symbol">$xdelta</span><span class="operator">,</span> <span class="symbol">$ydelta</span><span class="operator">,</span> <span class="symbol">$zdelta</span><span class="structure">)</span> <span class="operator">=</span> <span class="magic">@_</span><span class="structure">;</span><br />&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">xspin</span><span class="structure">(</span> <span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">xspin</span> <span class="operator">+</span> <span class="symbol">$xdelta</span> <span class="structure">);</span><br />&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">yspin</span><span class="structure">(</span> <span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">yspin</span> <span class="operator">+</span> <span class="symbol">$ydelta</span> <span class="structure">);</span><br />&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">zspin</span><span class="structure">(</span> <span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">zspin</span> <span class="operator">+</span> <span class="symbol">$zdelta</span> <span class="structure">);</span><br /><span class="structure">}</span><br /><br /><span class="number">1</span><span class="structure">;</span></code><br />&nbsp;</td></table>

<p>I&#39;ve been working on this team for a number of years, and we have frequently had to switch vendors and change implementations many times for various projects. If I have to replace the OpenGL code in the future, this separation of concerns helps ease the transition because the model and draw logic are in separate files, reducing the temptation of mixing them.</p>

<h3 id="OpenGL-and-Perl">OpenGL and Perl</h3>

<p>In order to use the GL functions from Perl, I wrote a partial set of GL bindings for Perl using FFI. FFI is a technique for calling code in dynamic libraries from a scripting language like Perl without writing XS, which is tied closely to the internal implementation of Perl itself.</p>

<p>We here at North Pole Inc. are big users of FFI because we don&#39;t have many XS programmers, and we often need to call into libraries written in other languages which don&#39;t have XS bindings yet. Last year we were using <a href="https://metacpan.org/module/FFI::Raw">FFI::Raw</a>, which at the time was the only practical FFI available on CPAN.</p>

<p>Over our long summer break this year, an aquatic mammal who was visiting from down under introduced us to <a href="https://metacpan.org/module/FFI::Platypus">FFI::Platypus</a>. We liked it so much we have largely migrated to it for all of our existing FFI code. Here are my bindings for the base OpenGL library.</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;<br />7:&nbsp;<br />8:&nbsp;<br />9:&nbsp;<br />10:&nbsp;<br />11:&nbsp;<br />12:&nbsp;<br />13:&nbsp;<br />14:&nbsp;<br />15:&nbsp;<br />16:&nbsp;<br />17:&nbsp;<br />18:&nbsp;<br />19:&nbsp;<br />20:&nbsp;<br />21:&nbsp;<br />22:&nbsp;<br />23:&nbsp;<br />24:&nbsp;<br />25:&nbsp;<br />26:&nbsp;<br />27:&nbsp;<br />28:&nbsp;<br />29:&nbsp;<br />30:&nbsp;<br />31:&nbsp;<br />32:&nbsp;<br />33:&nbsp;<br />34:&nbsp;<br />35:&nbsp;<br />36:&nbsp;<br />37:&nbsp;<br />38:&nbsp;<br />39:&nbsp;<br />40:&nbsp;<br />41:&nbsp;<br />42:&nbsp;<br />43:&nbsp;<br />44:&nbsp;<br />45:&nbsp;<br />46:&nbsp;<br />47:&nbsp;<br />48:&nbsp;<br />49:&nbsp;<br />50:&nbsp;<br />51:&nbsp;<br />52:&nbsp;<br />53:&nbsp;<br />54:&nbsp;<br />55:&nbsp;<br />56:&nbsp;<br />57:&nbsp;<br />58:&nbsp;<br />59:&nbsp;<br />60:&nbsp;<br />61:&nbsp;<br />62:&nbsp;<br />63:&nbsp;<br />64:&nbsp;<br />65:&nbsp;<br />66:&nbsp;<br />67:&nbsp;<br />68:&nbsp;<br />69:&nbsp;<br />70:&nbsp;<br />71:&nbsp;<br />72:&nbsp;<br />73:&nbsp;<br />74:&nbsp;<br />75:&nbsp;<br />76:&nbsp;<br />77:&nbsp;<br />78:&nbsp;<br />79:&nbsp;<br />80:&nbsp;<br />81:&nbsp;<br />82:&nbsp;<br />83:&nbsp;<br />84:&nbsp;<br />85:&nbsp;<br />86:&nbsp;<br />87:&nbsp;<br />88:&nbsp;<br />89:&nbsp;<br />90:&nbsp;<br />91:&nbsp;<br />92:&nbsp;<br />93:&nbsp;<br />94:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="keyword">package</span> <span class="word">GL</span><span class="structure">;</span><br /><br /><span class="keyword">use</span> <span class="pragma">strict</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="pragma">warnings</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="word">FFI::Platypus</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="word">FFI::CheckLib</span> <span class="words">qw( find_lib_or_die )</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="pragma">base</span> <span class="words">qw( Exporter )</span><span class="structure">;</span><br />&nbsp;<br /><span class="comment"># standard constants defined with Perl<br /></span><br /><span class="keyword">use</span> <span class="pragma">constant</span> <span class="structure">{</span><br />&nbsp;&nbsp;<span class="word">GL_SMOOTH</span>              <span class="operator">=&gt;</span> <span class="hex">0x1D01</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">GL_DEPTH_TEST</span>          <span class="operator">=&gt;</span> <span class="hex">0x0B71</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">GL_BLEND</span>               <span class="operator">=&gt;</span> <span class="hex">0x0BE2</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">GL_TRUE</span>                <span class="operator">=&gt;</span> <span class="number">0</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">GL_FALSE</span>               <span class="operator">=&gt;</span> <span class="number">0</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">GL_LIGHTING</span>            <span class="operator">=&gt;</span> <span class="hex">0x0B50</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">GL_LIGHT0</span>              <span class="operator">=&gt;</span> <span class="hex">0x4000</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">GL_DIFFUSE</span>             <span class="operator">=&gt;</span> <span class="hex">0x1201</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">GL_POSITION</span>            <span class="operator">=&gt;</span> <span class="hex">0x1203</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">GL_COLOR_BUFFER_BIT</span>    <span class="operator">=&gt;</span> <span class="hex">0x00004000</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">GL_DEPTH_BUFFER_BIT</span>    <span class="operator">=&gt;</span> <span class="hex">0x00000100</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">GL_CULL_FACE</span>           <span class="operator">=&gt;</span> <span class="hex">0x0B44</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">GL_PROJECTION</span>          <span class="operator">=&gt;</span> <span class="hex">0x1701</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">GL_MODELVIEW</span>           <span class="operator">=&gt;</span> <span class="hex">0x1700</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">GL_SRC_ALPHA</span>           <span class="operator">=&gt;</span> <span class="hex">0x0302</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">GL_ONE_MINUS_SRC_ALPHA</span> <span class="operator">=&gt;</span> <span class="hex">0x0303</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">GL_COLOR_MATERIAL</span>      <span class="operator">=&gt;</span> <span class="hex">0x0B57</span><span class="operator">,</span><br /><span class="structure">};</span><br /><br /><span class="comment"># wire up FFI::Platypus directly to the binary OpenGL libraries<br /># (using FFI::CheckLib to find them wherever they are on our system)<br /></span><br /><span class="keyword">our</span> <span class="symbol">$ffi</span> <span class="operator">=</span> <span class="word">FFI::Platypus</span><span class="operator">-&gt;</span><span class="word">new</span><span class="structure">(</span><br />&nbsp;&nbsp;<span class="word">lib</span> <span class="operator">=&gt;</span> <span class="structure">[</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="magic">$^O</span> <span class="operator">eq</span> <span class="single">'darwin'</span> <span class="operator">?</span> <span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="double">&quot;/System/Library/Frameworks/OpenGL.framework/Libraries/libGL.dylib&quot;</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="double">&quot;/System/Library/Frameworks/OpenGL.framework/Libraries/libGLU.dylib&quot;</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="double">&quot;/System/Library/Frameworks/GLUT.framework/GLUT&quot;</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">)</span> <span class="operator">:</span> <span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">find_lib_or_die</span><span class="structure">(</span><span class="word">lib</span> <span class="operator">=&gt;</span> <span class="single">'glut'</span><span class="structure">)</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">find_lib_or_die</span><span class="structure">(</span><span class="word">lib</span> <span class="operator">=&gt;</span> <span class="single">'GLU'</span><span class="structure">)</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">find_lib_or_die</span><span class="structure">(</span><span class="word">lib</span> <span class="operator">=&gt;</span> <span class="single">'GL'</span><span class="structure">)</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">)</span><br />&nbsp;&nbsp;<span class="structure">]</span><span class="operator">,</span><br /><span class="structure">);</span><br /><br /><span class="comment"># declare named shortcuts for the in-built c-types<br /></span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">type</span><span class="structure">(</span><span class="single">'unsigned int'</span> <span class="operator">=&gt;</span> <span class="single">'GLenum'</span><span class="structure">);</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">type</span><span class="structure">(</span><span class="single">'unsigned char'</span> <span class="operator">=&gt;</span> <span class="single">'GLboolean'</span><span class="structure">);</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">type</span><span class="structure">(</span><span class="single">'int'</span> <span class="operator">=&gt;</span> <span class="single">'GLint'</span><span class="structure">);</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">type</span><span class="structure">(</span><span class="single">'double'</span> <span class="operator">=&gt;</span> <span class="single">'GLdouble'</span><span class="structure">);</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">type</span><span class="structure">(</span><span class="single">'float[]'</span> <span class="operator">=&gt;</span> <span class="single">'GLfloat_array'</span><span class="structure">);</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">type</span><span class="structure">(</span><span class="single">'unsigned int'</span> <span class="operator">=&gt;</span> <span class="single">'GLbitfield'</span><span class="structure">);</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">type</span><span class="structure">(</span><span class="single">'int'</span> <span class="operator">=&gt;</span> <span class="single">'GLsizei'</span><span class="structure">);</span><br /><br /><span class="comment"># declare the functions and how their parameters and return<br /># values should be mapped to Perl scalars<br /></span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glShadeModel</span> <span class="operator">=&gt;</span> <span class="structure">[</span><span class="single">'GLenum'</span><span class="structure">]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="structure">);</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glEnable</span>     <span class="operator">=&gt;</span> <span class="structure">[</span><span class="single">'GLenum'</span><span class="structure">]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="structure">);</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glDisable</span>    <span class="operator">=&gt;</span> <span class="structure">[</span><span class="single">'GLenum'</span><span class="structure">]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="structure">);</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glPushMatrix</span> <span class="operator">=&gt;</span> <span class="structure">[]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="structure">);</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glPopMatrix</span>  <span class="operator">=&gt;</span> <span class="structure">[]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="structure">);</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glFlush</span>      <span class="operator">=&gt;</span> <span class="structure">[]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="structure">);</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glRotated</span>    <span class="operator">=&gt;</span> <span class="structure">[</span> <span class="single">'GLdouble'</span><span class="operator">,</span> <span class="single">'GLdouble'</span><span class="operator">,</span> <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="single">'GLdouble'</span><span class="operator">,</span> <span class="single">'GLdouble'</span> <span class="structure">]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="structure">);</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glTranslated</span> <span class="operator">=&gt;</span> <span class="structure">[</span><span class="single">'GLdouble'</span><span class="operator">,</span> <span class="single">'GLdouble'</span><span class="operator">,</span> <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="single">'GLdouble'</span> <span class="structure">]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="structure">);</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glColor4d</span>    <span class="operator">=&gt;</span> <span class="structure">[</span> <span class="single">'GLdouble'</span><span class="operator">,</span> <span class="single">'GLdouble'</span><span class="operator">,</span> <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="single">'GLdouble'</span><span class="operator">,</span> <span class="single">'GLdouble'</span> <span class="structure">]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="structure">);</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glColor3d</span>    <span class="operator">=&gt;</span> <span class="structure">[</span> <span class="single">'GLdouble'</span><span class="operator">,</span> <span class="single">'GLdouble'</span><span class="operator">,</span> <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="single">'GLdouble'</span> <span class="structure">]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="structure">);</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glLightfv</span>    <span class="operator">=&gt;</span> <span class="structure">[</span> <span class="single">'GLenum'</span><span class="operator">,</span> <span class="single">'GLenum'</span><span class="operator">,</span> <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="single">'GLfloat_array'</span> <span class="structure">]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="structure">);</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glClear</span>      <span class="operator">=&gt;</span> <span class="structure">[</span> <span class="single">'GLbitfield'</span> <span class="structure">]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="structure">);</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glScaled</span>     <span class="operator">=&gt;</span> <span class="structure">[</span> <span class="single">'GLdouble'</span><span class="operator">,</span> <span class="single">'GLdouble'</span><span class="operator">,</span> <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="single">'GLdouble'</span> <span class="structure">]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="structure">);</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glClearColor</span> <span class="operator">=&gt;</span> <span class="structure">[</span><span class="single">'float'</span><span class="operator">,</span> <span class="single">'float'</span><span class="operator">,</span> <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="single">'float'</span><span class="operator">,</span> <span class="single">'float'</span> <span class="structure">]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="structure">);</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glMatrixMode</span> <span class="operator">=&gt;</span> <span class="structure">[</span> <span class="single">'GLenum'</span> <span class="structure">]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="structure">);</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glViewport</span>   <span class="operator">=&gt;</span> <span class="structure">[</span> <span class="single">'GLint'</span><span class="operator">,</span> <span class="single">'GLint'</span><span class="operator">,</span> <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="single">'GLsizei'</span><span class="operator">,</span> <span class="single">'GLsizei'</span> <span class="structure">]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="structure">);</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glBlendFunc</span>  <span class="operator">=&gt;</span> <span class="structure">[</span> <span class="single">'GLenum'</span><span class="operator">,</span> <span class="single">'GLenum'</span> <span class="structure">]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="structure">);</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glLoadIdentity</span> <span class="operator">=&gt;</span> <span class="structure">[]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="structure">);</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">gluPerspective</span> <span class="operator">=&gt;</span> <span class="structure">[</span><span class="single">'GLdouble'</span><span class="operator">,</span><span class="single">'GLdouble'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="single">'GLdouble'</span><span class="operator">,</span><span class="single">'GLdouble'</span><span class="structure">]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="structure">);</span><br /><br /><span class="comment"># export those functions to the caller<br /></span><br /><span class="keyword">our</span> <span class="symbol">@EXPORT</span> <span class="operator">=</span> <span class="structure">(</span><span class="word">grep</span> <span class="match">/^(gl|GL_)/i</span><span class="operator">,</span> <span class="word">keys</span> <span class="symbol">%GL::</span><span class="structure">);</span><br /><br /><span class="number">1</span><span class="structure">;</span></code><br />&nbsp;</td></table>

<p>After the usual module imports, you can see the first thing that I&#39;ve defined are a number of constants which are used by OpenGL. These constants are usually defined in C header (.h) files. This can be problematic if the constants change frequently, but so long as the library is stable and the implementers are not feeling cruel this can be okay.</p>

<p>The next piece of code creates an instance of <a href="https://metacpan.org/module/FFI::Platypus">FFI::Platypus</a> which we will use to create the bindings to the library:</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;<br />7:&nbsp;<br />8:&nbsp;<br />9:&nbsp;<br />10:&nbsp;<br />11:&nbsp;<br />12:&nbsp;<br />13:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="keyword">our</span> <span class="symbol">$ffi</span> <span class="operator">=</span> <span class="word">FFI::Platypus</span><span class="operator">-&gt;</span><span class="word">new</span><span class="structure">(</span><br />&nbsp;&nbsp;<span class="word">lib</span> <span class="operator">=&gt;</span> <span class="structure">[</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="magic">$^O</span> <span class="operator">eq</span> <span class="single">'darwin'</span> <span class="operator">?</span> <span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="double">&quot;/System/Library/Frameworks/OpenGL.framework/Libraries/libGL.dylib&quot;</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="double">&quot;/System/Library/Frameworks/OpenGL.framework/Libraries/libGLU.dylib&quot;</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="double">&quot;/System/Library/Frameworks/GLUT.framework/GLUT&quot;</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">)</span> <span class="operator">:</span> <span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">find_lib_or_die</span><span class="structure">(</span><span class="word">lib</span> <span class="operator">=&gt;</span> <span class="single">'glut'</span><span class="structure">)</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">find_lib_or_die</span><span class="structure">(</span><span class="word">lib</span> <span class="operator">=&gt;</span> <span class="single">'GLU'</span><span class="structure">)</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">find_lib_or_die</span><span class="structure">(</span><span class="word">lib</span> <span class="operator">=&gt;</span> <span class="single">'GL'</span><span class="structure">)</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">)</span><br />&nbsp;&nbsp;<span class="structure">]</span><span class="operator">,</span><br /><span class="structure">);</span> </code><br />&nbsp;</td></table>

<p>We need to tell Platypus which dynamic libraries to search in order to find functions, so we are using <a href="https://metacpan.org/module/FFI::CheckLib">FFI::CheckLib</a>, which is a portable way of searching for libraries in the usual system locations. It provides a similar interface to the like-named <a href="https://metacpan.org/module/Devel::CheckLib">Devel::CheckLib</a>, but is smarter about finding <i>dynamic</i> libraries. We have a mixed environment of OS X and Linux for toy deliveries and testing, so it had to work on both platforms. Although <a href="https://metacpan.org/module/FFI::CheckLib">FFI::CheckLib</a> generally works well in Windows, Linux, OS X (and others), the OpenGL libraries on OS X are part of what they call a &quot;framework&quot;, which isn&#39;t supported by <a href="https://metacpan.org/module/FFI::CheckLib">FFI::CheckLib</a> yet, so I hard coded the location of the libraries on that platform.</p>

<p>The next part of the code defines the types used by the library:</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">type</span><span class="structure">(</span><span class="single">'unsigned int'</span> <span class="operator">=&gt;</span> <span class="single">'GLenum'</span><span class="structure">);</span><br /><span class="operator">...</span></code><br />&nbsp;</td></table>

<p>This line defines <code>GLenum</code> used throughout the GL library. Although you could just use <code>&#39;unsigned int&#39;</code> throughout your code where GLenum is called for, this makes my code more readable, and it is easier to fix the type in one place if I make a mistake with <code>GLenum</code>.</p>

<p>In general, the type system for Platypus is a bit different than other FFI implementations that I&#39;ve used. Instead of providing only basic hardware types like &quot;sixteen bit signed integer&quot;, Platypus encourages the use of language and platform specific types--typically the same types that are understood by your library interface specifications (In C the header file). For example <code>long</code> is a 32 or 64 bit signed integer depending on your platform and <code>char</code> might be either signed or unsigned! You can even tell Platypus that you are working with Fortran or Rust and use the native types of those languages in your bindings.</p>

<p>Finally in the meat of the module we attach the functions from the library into the GL namespace:</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glEnable</span> <span class="operator">=&gt;</span> <span class="structure">[</span><span class="single">'GLenum'</span><span class="structure">]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="structure">);</span><br /><span class="operator">...</span><br /><span class="comment"># which is called thusly:<br /></span><span class="word">glEnable</span><span class="structure">(</span><span class="word">GL_LIGHT0</span><span class="structure">);</span></code><br />&nbsp;</td></table>

<p>The <code>attach</code> method takes a function defined in the dynamic library and attaches it as a real Perl subroutine. The advantage to this approach is that the code that calls our GL library doesn&#39;t need to know or care that it is using an FFI implementation or an XS one. It just looks like Perl.</p>

<p>I needed some higher level types, like arrays (Platypus supports a number of higher level types like this):</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;<br />7:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">type</span><span class="structure">(</span><span class="single">'float[]'</span> <span class="operator">=&gt;</span> <span class="single">'GLfloat_array'</span><span class="structure">);</span><br /><span class="operator">...</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glLightfv</span>    <span class="operator">=&gt;</span> <span class="structure">[</span> <span class="single">'GLenum'</span><span class="operator">,</span> <span class="single">'GLenum'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="single">'GLfloat_array'</span> <span class="structure">]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="structure">);</span><br /><span class="operator">...</span><br /><span class="word">glLightfv</span><span class="structure">(</span><span class="word">GL_LIGHT0</span><span class="operator">,</span> <span class="word">GL_DIFFUSE</span><span class="operator">,</span> <span class="structure">[</span><span class="float">.9</span><span class="operator">,</span> <span class="float">.9</span><span class="operator">,</span> <span class="float">1.0</span><span class="operator">,</span> <span class="float">1.0</span><span class="structure">]);</span><br /><span class="word">glLightfv</span><span class="structure">(</span><span class="word">GL_LIGHT0</span><span class="operator">,</span> <span class="word">GL_POSITION</span><span class="operator">,</span> <span class="structure">[</span><span class="float">1.0</span><span class="operator">,</span> <span class="float">1.0</span><span class="operator">,</span> <span class="float">1.0</span><span class="operator">,</span> <span class="float">0.0</span><span class="structure">]);</span></code><br />&nbsp;</td></table>

<p>To do this sort of thing, many FFI implementations require you to create an array object and pass that in as an argument. Unfortunately there is an overhead to creating objects for single use calls like this, and it also exposes unnecessary complexity to your caller.</p>

<p>Finally, this module uses Exporter to export all of its functions to the caller&#39;s namespace:</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="keyword">use</span> <span class="pragma">base</span> <span class="words">qw( Exporter )</span><span class="structure">;</span><br /><span class="operator">...</span><br /><span class="word">our</span> <span class="symbol">@EXPORT</span> <span class="operator">=</span> <span class="structure">(</span><span class="word">grep</span> <span class="match">/^(gl|GL_)/i</span><span class="operator">,</span> <span class="word">keys</span> <span class="symbol">%GL::</span><span class="structure">);</span></code><br />&nbsp;</td></table>

<p>Many libraries implement hundreds of functions and keeping <code>@EXPORT</code> in sync with functions as we add them is very tedious. Instead we use <code>%GL::</code> which is a special hash that keeps track of the data structures (including subroutines) in the GL namespace. It has to be put at the bottom of the module because <code>%GL::</code> won&#39;t be populated until the <code>attach</code> calls are made.</p>

<p>The last module we need provides the Glut bindings. Glut provides a simple and portable OpenGL focused event loop for applications that do not require anything more complicated.</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;<br />7:&nbsp;<br />8:&nbsp;<br />9:&nbsp;<br />10:&nbsp;<br />11:&nbsp;<br />12:&nbsp;<br />13:&nbsp;<br />14:&nbsp;<br />15:&nbsp;<br />16:&nbsp;<br />17:&nbsp;<br />18:&nbsp;<br />19:&nbsp;<br />20:&nbsp;<br />21:&nbsp;<br />22:&nbsp;<br />23:&nbsp;<br />24:&nbsp;<br />25:&nbsp;<br />26:&nbsp;<br />27:&nbsp;<br />28:&nbsp;<br />29:&nbsp;<br />30:&nbsp;<br />31:&nbsp;<br />32:&nbsp;<br />33:&nbsp;<br />34:&nbsp;<br />35:&nbsp;<br />36:&nbsp;<br />37:&nbsp;<br />38:&nbsp;<br />39:&nbsp;<br />40:&nbsp;<br />41:&nbsp;<br />42:&nbsp;<br />43:&nbsp;<br />44:&nbsp;<br />45:&nbsp;<br />46:&nbsp;<br />47:&nbsp;<br />48:&nbsp;<br />49:&nbsp;<br />50:&nbsp;<br />51:&nbsp;<br />52:&nbsp;<br />53:&nbsp;<br />54:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="keyword">package</span> <span class="word">GLUT</span><span class="structure">;</span><br /><br /><span class="keyword">use</span> <span class="pragma">strict</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="pragma">warnings</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="float">5.010</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="word">GL</span> <span class="structure">();</span><br /><span class="keyword">use</span> <span class="pragma">base</span> <span class="words">qw( Exporter )</span><span class="structure">;</span><br />&nbsp;&nbsp;<br /><span class="keyword">use</span> <span class="pragma">constant</span> <span class="structure">{</span><br />&nbsp;&nbsp;<span class="word">GLUT_RGB</span>      <span class="operator">=&gt;</span> <span class="hex">0x0000</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">GLUT_DOUBLE</span>   <span class="operator">=&gt;</span> <span class="hex">0x0002</span><span class="operator">,</span><br />&nbsp;&nbsp;<span class="word">GLUT_DEPTH</span>    <span class="operator">=&gt;</span> <span class="hex">0x0010</span><span class="operator">,</span><br /><span class="structure">};</span><br /><br /><span class="keyword">my</span> <span class="symbol">$ffi</span> <span class="operator">=</span> <span class="symbol">$GL::ffi</span><span class="structure">;</span><br />&nbsp;&nbsp;<br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">load_custom_type</span><span class="structure">(</span><span class="single">'FFI::Platypus::Type::StringArray'</span> <span class="operator">=&gt;</span> <span class="single">'string_array'</span><span class="structure">);</span><br /><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glutInit</span> <span class="operator">=&gt;</span> <span class="structure">[</span><span class="single">'int*'</span><span class="operator">,</span> <span class="single">'string_array'</span> <span class="structure">]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span> <span class="structure">{</span><br />&nbsp;&nbsp;<span class="keyword">my</span><span class="structure">(</span><span class="symbol">$xsub</span><span class="operator">,</span> <span class="symbol">@args</span><span class="structure">)</span> <span class="operator">=</span> <span class="magic">@_</span><span class="structure">;</span><br />&nbsp;&nbsp;<span class="keyword">my</span> <span class="symbol">$size</span> <span class="operator">=</span> <span class="word">scalar</span> <span class="symbol">@args</span><span class="structure">;</span><br />&nbsp;&nbsp;<span class="symbol">$xsub</span><span class="operator">-&gt;</span><span class="structure">(</span><span class="cast">\</span><span class="symbol">$size</span><span class="operator">,</span> <span class="cast">\</span><span class="symbol">@args</span><span class="structure">);</span><br /><span class="structure">});</span><br />&nbsp;&nbsp;<br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glutInitDisplayMode</span> <span class="operator">=&gt;</span> <span class="structure">[</span><span class="single">'unsigned int'</span><span class="structure">]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="structure">);</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glutInitWindowSize</span>  <span class="operator">=&gt;</span> <span class="structure">[</span><span class="single">'int'</span><span class="operator">,</span> <span class="single">'int'</span><span class="structure">]</span>   <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="structure">);</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glutCreateWindow</span>    <span class="operator">=&gt;</span> <span class="structure">[</span><span class="single">'string'</span><span class="structure">]</span>       <span class="operator">=&gt;</span> <span class="single">'int'</span>  <span class="structure">);</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glutMainLoop</span>        <span class="operator">=&gt;</span> <span class="structure">[</span> <span class="structure">]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="structure">);</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glutSwapBuffers</span>     <span class="operator">=&gt;</span> <span class="structure">[]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="structure">);</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glutPostRedisplay</span>   <span class="operator">=&gt;</span> <span class="structure">[]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="structure">);</span><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glutSolidCone</span>        <span class="operator">=&gt;</span> <span class="structure">[</span> <span class="single">'GLdouble'</span><span class="operator">,</span> <span class="single">'GLdouble'</span><span class="operator">,</span> <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="single">'GLint'</span><span class="operator">,</span> <span class="single">'GLint'</span> <span class="structure">]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="structure">);</span><br />&nbsp;&nbsp;<br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glutDisplayFunc</span> <span class="operator">=&gt;</span> <span class="structure">[</span> <span class="single">'()-&gt;void'</span> <span class="structure">]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span> <span class="structure">{</span><br />&nbsp;&nbsp;<span class="keyword">my</span><span class="structure">(</span><span class="symbol">$xsub</span><span class="operator">,</span> <span class="symbol">$callback</span><span class="structure">)</span> <span class="operator">=</span> <span class="magic">@_</span><span class="structure">;</span><br />&nbsp;&nbsp;<span class="word">state</span> <span class="symbol">$closure</span> <span class="operator">=</span> <span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">closure</span><span class="structure">(</span><span class="symbol">$callback</span><span class="structure">);</span><br />&nbsp;&nbsp;<span class="symbol">$xsub</span><span class="operator">-&gt;</span><span class="structure">(</span><span class="symbol">$closure</span><span class="structure">);</span><br /><span class="structure">});</span><br /><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glutIdleFunc</span> <span class="operator">=&gt;</span> <span class="structure">[</span> <span class="single">'()-&gt;void'</span> <span class="structure">]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span> <span class="structure">{</span><br />&nbsp;&nbsp;<span class="keyword">my</span><span class="structure">(</span><span class="symbol">$xsub</span><span class="operator">,</span> <span class="symbol">$callback</span><span class="structure">)</span> <span class="operator">=</span> <span class="magic">@_</span><span class="structure">;</span><br />&nbsp;&nbsp;<span class="word">state</span> <span class="symbol">$closure</span> <span class="operator">=</span> <span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">closure</span><span class="structure">(</span><span class="symbol">$callback</span><span class="structure">);</span><br />&nbsp;&nbsp;<span class="symbol">$xsub</span><span class="operator">-&gt;</span><span class="structure">(</span><span class="symbol">$closure</span><span class="structure">);</span><br /><span class="structure">});</span><br /><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glutReshapeFunc</span> <span class="operator">=&gt;</span> <span class="structure">[</span> <span class="single">'(int,int)-&gt;void'</span> <span class="structure">]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span> <span class="structure">{</span><br />&nbsp;&nbsp;<span class="keyword">my</span><span class="structure">(</span><span class="symbol">$xsub</span><span class="operator">,</span> <span class="symbol">$callback</span><span class="structure">)</span> <span class="operator">=</span> <span class="magic">@_</span><span class="structure">;</span><br />&nbsp;&nbsp;<span class="word">state</span> <span class="symbol">$closure</span> <span class="operator">=</span> <span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">closure</span><span class="structure">(</span><span class="symbol">$callback</span><span class="structure">);</span><br />&nbsp;&nbsp;<span class="symbol">$xsub</span><span class="operator">-&gt;</span><span class="structure">(</span><span class="symbol">$closure</span><span class="structure">);</span><br /><span class="structure">});</span><br />&nbsp;&nbsp;<br /><span class="keyword">our</span> <span class="symbol">@EXPORT</span> <span class="operator">=</span> <span class="structure">(</span><span class="word">grep</span> <span class="match">/^(GLUT_|glut)/i</span><span class="operator">,</span> <span class="word">keys</span> <span class="symbol">%GLUT::</span><span class="structure">);</span><br /><br /><span class="number">1</span><span class="structure">;</span></code><br />&nbsp;</td></table>

<p>A few things are interesting here. Firstly, the <code>glutInit()</code> takes an array of C strings as its second argument.</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;<br />7:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">load_custom_type</span><span class="structure">(</span><span class="single">'FFI::Platypus::Type::StringArray'</span> <span class="operator">=&gt;</span> <span class="single">'string_array'</span><span class="structure">);</span><br /><br /><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glutInit</span> <span class="operator">=&gt;</span> <span class="structure">[</span><span class="single">'int*'</span><span class="operator">,</span> <span class="single">'string_array'</span> <span class="structure">]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span> <span class="structure">{</span><br />&nbsp;&nbsp;<span class="keyword">my</span><span class="structure">(</span><span class="symbol">$xsub</span><span class="operator">,</span> <span class="symbol">@args</span><span class="structure">)</span> <span class="operator">=</span> <span class="magic">@_</span><span class="structure">;</span><br />&nbsp;&nbsp;<span class="keyword">my</span> <span class="symbol">$size</span> <span class="operator">=</span> <span class="word">scalar</span> <span class="symbol">@args</span><span class="structure">;</span><br />&nbsp;&nbsp;<span class="symbol">$xsub</span><span class="operator">-&gt;</span><span class="structure">(</span><span class="cast">\</span><span class="symbol">$size</span><span class="operator">,</span> <span class="cast">\</span><span class="symbol">@args</span><span class="structure">);</span><br /><span class="structure">});</span></code><br />&nbsp;</td></table>

<p>Platypus&#39; type system provides most of the common basic types that you will need. A few more specialized types, like arrays of C strings require the use of custom types. Here we are using <a href="https://metacpan.org/module/FFI::Platypus::Type::StringArray">FFI::Platypus::Type::StringArray</a> which is frequently useful and available on CPAN, but not part of the Platypus core.</p>

<p>Also interesting here is that we are using a wrapper (the last argument to the <code>attach</code>) call. This is to hide some of the messy differences between C and Perl. In C when you pass a dynamic array into a function you have to provide the size of the array as an additional parameter. In Perl, arrays already know how many elements they have. Basically the above code is a short cut for this:</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;<br />7:&nbsp;<br />8:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="structure">[</span> <span class="word">glutInit</span> <span class="operator">=&gt;</span> <span class="single">'_glutInit'</span><span class="structure">]</span> <span class="operator">=&gt;</span> <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">[</span><span class="single">'int*'</span><span class="operator">,</span> <span class="single">'string_array'</span>  <span class="structure">]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span><span class="structure">);</span><br /><br /><span class="keyword">sub</span> <span class="word">glutInit</span> <span class="structure">{</span><br />&nbsp;&nbsp;<span class="keyword">my</span><span class="structure">(</span><span class="symbol">@args</span><span class="structure">)</span> <span class="operator">=</span> <span class="magic">@_</span><span class="structure">;</span><br />&nbsp;&nbsp;<span class="keyword">my</span> <span class="symbol">$size</span> <span class="operator">=</span> <span class="word">scalar</span> <span class="symbol">@args</span><span class="structure">;</span><br />&nbsp;&nbsp;<span class="word">_glutInit</span><span class="structure">(</span><span class="cast">\</span><span class="symbol">$size</span><span class="operator">,</span> <span class="cast">\</span><span class="symbol">@args</span><span class="structure">);</span><br /><span class="structure">}</span></code><br />&nbsp;</td></table>

<p>In this second version we attach <code>glutInit</code> with a different name in Perl and call it from the &quot;real&quot; <code>glutInit</code>.</p>

<p>Also the size of the array is passed in as a pointer to an integer so that Glut can alter its value. Although in this particular case we ignore any changes made by Glut, the scalar <code>$size</code> <b>is</b> updated if <code>glutInit</code> makes a change. This is frequently useful, because a common pattern in C is to pass variables by reference by passing a pointer to that variable.</p>

<p>The last thing that I want to point out is the use of closures:</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">attach</span><span class="structure">(</span> <span class="word">glutDisplayFunc</span> <span class="operator">=&gt;</span> <span class="structure">[</span> <span class="single">'()-&gt;void'</span> <span class="structure">]</span> <span class="operator">=&gt;</span> <span class="single">'void'</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span> <span class="structure">{</span><br />&nbsp;&nbsp;<span class="keyword">my</span><span class="structure">(</span><span class="symbol">$xsub</span><span class="operator">,</span> <span class="symbol">$callback</span><span class="structure">)</span> <span class="operator">=</span> <span class="magic">@_</span><span class="structure">;</span><br />&nbsp;&nbsp;<span class="word">state</span> <span class="symbol">$closure</span> <span class="operator">=</span> <span class="symbol">$ffi</span><span class="operator">-&gt;</span><span class="word">closure</span><span class="structure">(</span><span class="symbol">$callback</span><span class="structure">);</span><br />&nbsp;&nbsp;<span class="symbol">$xsub</span><span class="operator">-&gt;</span><span class="structure">(</span><span class="symbol">$closure</span><span class="structure">);</span><br /><span class="structure">});</span></code><br />&nbsp;</td></table>

<p>Or calling back into Perl from C. This is extremely useful, but it is also a little tricky, because of the different ways that Perl and C manage memory. In C you must explicitly allocate and deallocate all memory. The convention is that the module that allocates a particular object will be responsible for deallocating it as well. In Perl the language itself takes responsibility for deallocating objects when they are no longer used anywhere in the Perl runtime. Unfortunately when we create a closure and pass it into Glut code, there is no way for Perl to keep track of whether or not the closure is still in use by Glut! In order to prevent Perl from reclaiming the subroutine before Glut is done with it, I save the closure into a <code>state</code> variable, which will keep it in scope for the life of the program.</p>

<h3 id="Bringing-It-All-Together">Bringing It All Together</h3>

<p>Now that we have all the ingredients, we can write out main script:</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;<br />7:&nbsp;<br />8:&nbsp;<br />9:&nbsp;<br />10:&nbsp;<br />11:&nbsp;<br />12:&nbsp;<br />13:&nbsp;<br />14:&nbsp;<br />15:&nbsp;<br />16:&nbsp;<br />17:&nbsp;<br />18:&nbsp;<br />19:&nbsp;<br />20:&nbsp;<br />21:&nbsp;<br />22:&nbsp;<br />23:&nbsp;<br />24:&nbsp;<br />25:&nbsp;<br />26:&nbsp;<br />27:&nbsp;<br />28:&nbsp;<br />29:&nbsp;<br />30:&nbsp;<br />31:&nbsp;<br />32:&nbsp;<br />33:&nbsp;<br />34:&nbsp;<br />35:&nbsp;<br />36:&nbsp;<br />37:&nbsp;<br />38:&nbsp;<br />39:&nbsp;<br />40:&nbsp;<br />41:&nbsp;<br />42:&nbsp;<br />43:&nbsp;<br />44:&nbsp;<br />45:&nbsp;<br />46:&nbsp;<br />47:&nbsp;<br />48:&nbsp;<br />49:&nbsp;<br />50:&nbsp;<br />51:&nbsp;<br />52:&nbsp;<br />53:&nbsp;<br />54:&nbsp;<br />55:&nbsp;<br />56:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="keyword">use</span> <span class="pragma">strict</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="pragma">warnings</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="word">GL</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="word">GLUT</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="word">Snowflake</span><span class="structure">;</span><br /><br /><span class="word">glutInit</span><span class="structure">(</span><span class="symbol">@ARGV</span><span class="structure">);</span><br /><span class="word">glutInitDisplayMode</span><span class="structure">(</span><span class="word">GLUT_DOUBLE</span> <span class="operator">|</span> <span class="word">GLUT_RGB</span> <span class="operator">|</span> <span class="word">GLUT_DEPTH</span><span class="structure">);</span><br /><span class="word">glutInitWindowSize</span><span class="structure">(</span><span class="number">1500</span><span class="operator">,</span><span class="number">500</span><span class="structure">);</span><br /><span class="word">glutCreateWindow</span><span class="structure">(</span><span class="single">'snowflake'</span><span class="structure">);</span><br /><span class="word">glLightfv</span><span class="structure">(</span><span class="word">GL_LIGHT0</span><span class="operator">,</span> <span class="word">GL_DIFFUSE</span><span class="operator">,</span> <span class="structure">[</span><span class="float">.9</span><span class="operator">,</span> <span class="float">.9</span><span class="operator">,</span> <span class="float">1.0</span><span class="operator">,</span> <span class="float">1.0</span><span class="structure">]);</span><br /><span class="word">glLightfv</span><span class="structure">(</span><span class="word">GL_LIGHT0</span><span class="operator">,</span> <span class="word">GL_POSITION</span><span class="operator">,</span> <span class="structure">[</span><span class="float">1.0</span><span class="operator">,</span> <span class="float">1.0</span><span class="operator">,</span> <span class="float">1.0</span><span class="operator">,</span> <span class="float">0.0</span><span class="structure">]);</span><br /><span class="word">glEnable</span><span class="structure">(</span><span class="word">GL_LIGHT0</span><span class="structure">);</span><br /><span class="word">glEnable</span><span class="structure">(</span><span class="word">GL_LIGHTING</span><span class="structure">);</span><br /><span class="word">glEnable</span><span class="structure">(</span><span class="word">GL_CULL_FACE</span><span class="structure">);</span><br /><span class="word">glShadeModel</span><span class="structure">(</span><span class="word">GL_SMOOTH</span><span class="structure">);</span><br /><span class="word">glClearColor</span><span class="structure">(</span><span class="float">1.0</span><span class="operator">,</span> <span class="float">1.0</span><span class="operator">,</span> <span class="float">1.0</span><span class="operator">,</span> <span class="float">0.0</span><span class="structure">);</span><br /><span class="word">glBlendFunc</span><span class="structure">(</span><span class="word">GL_SRC_ALPHA</span><span class="operator">,</span> <span class="word">GL_ONE_MINUS_SRC_ALPHA</span><span class="structure">);</span><br /><br /><span class="word">glEnable</span><span class="structure">(</span><span class="word">GL_DEPTH_TEST</span><span class="structure">);</span><br /><br /><span class="keyword">my</span> <span class="symbol">@flakes</span> <span class="operator">=</span> <span class="word">map</span> <span class="structure">{</span> <span class="word">Snowflake</span><span class="operator">-&gt;</span><span class="word">new</span><span class="structure">(</span><span class="word">z</span> <span class="operator">=&gt;</span> <span class="float">-5.0</span><span class="operator">,</span> <span class="word">x</span> <span class="operator">=&gt;</span> <span class="magic">$_</span><span class="structure">)</span> <span class="structure">}</span> <span class="structure">(</span> <span class="float">2.0</span><span class="operator">,</span> <span class="float">0.0</span><span class="operator">,</span> <span class="float">-2.0</span> <span class="structure">);</span><br /><br /><span class="keyword">sub</span> <span class="word">display</span> <span class="structure">{</span><br /><br />&nbsp;&nbsp;<span class="word">glClear</span><span class="structure">(</span><span class="word">GL_COLOR_BUFFER_BIT</span> <span class="operator">|</span> <span class="word">GL_DEPTH_BUFFER_BIT</span><span class="structure">);</span><br />&nbsp;&nbsp;<span class="word">glLoadIdentity</span><span class="structure">();</span><br /><br />&nbsp;&nbsp;<span class="magic">$_</span><span class="operator">-&gt;</span><span class="word">draw</span> <span class="word">for</span> <span class="symbol">@flakes</span><span class="structure">;</span><br /><br />&nbsp;&nbsp;<span class="word">glFlush</span><span class="structure">();</span><br />&nbsp;&nbsp;<span class="word">glutSwapBuffers</span><span class="structure">();</span><br /><span class="structure">}</span><br /><br /><span class="keyword">sub</span> <span class="word">idle</span> <span class="structure">{</span><br />&nbsp;&nbsp;<span class="symbol">$flakes</span><span class="structure">[</span><span class="number">0</span><span class="structure">]</span><span class="operator">-&gt;</span><span class="word">spin</span><span class="structure">(</span><span class="float">0.3</span><span class="operator">,</span> <span class="float">0.6</span><span class="operator">,</span> <span class="float">0.0</span><span class="structure">);</span><br />&nbsp;&nbsp;<span class="symbol">$flakes</span><span class="structure">[</span><span class="number">1</span><span class="structure">]</span><span class="operator">-&gt;</span><span class="word">spin</span><span class="structure">(</span><span class="float">0.3</span><span class="operator">,</span> <span class="float">0.0</span><span class="operator">,</span> <span class="float">0.6</span><span class="structure">);</span><br />&nbsp;&nbsp;<span class="symbol">$flakes</span><span class="structure">[</span><span class="number">2</span><span class="structure">]</span><span class="operator">-&gt;</span><span class="word">spin</span><span class="structure">(</span><span class="float">0.0</span><span class="operator">,</span> <span class="float">0.3</span><span class="operator">,</span> <span class="float">0.6</span><span class="structure">);</span><br />&nbsp;&nbsp;<span class="word">glutPostRedisplay</span><span class="structure">();</span><br /><span class="structure">}</span><br /><br /><span class="keyword">sub</span> <span class="word">reshape</span> <span class="structure">{</span><br />&nbsp;&nbsp;<span class="keyword">my</span><span class="structure">(</span><span class="symbol">$x</span><span class="operator">,</span> <span class="symbol">$y</span><span class="structure">)</span> <span class="operator">=</span> <span class="magic">@_</span><span class="structure">;</span><br />&nbsp;&nbsp;<span class="word">exit</span> <span class="word">if</span> <span class="symbol">$x</span> <span class="operator">==</span> <span class="number">0</span> <span class="operator">||</span> <span class="symbol">$y</span> <span class="operator">==</span> <span class="number">0</span><span class="structure">;</span><br /><br />&nbsp;&nbsp;<span class="word">glMatrixMode</span><span class="structure">(</span><span class="word">GL_PROJECTION</span><span class="structure">);</span><br />&nbsp;&nbsp;<span class="word">glLoadIdentity</span><span class="structure">();</span><br />&nbsp;&nbsp;<span class="word">gluPerspective</span><span class="structure">(</span><span class="float">30.0</span><span class="operator">,</span> <span class="symbol">$x</span> <span class="operator">/</span> <span class="symbol">$y</span><span class="operator">,</span> <span class="float">0.5</span><span class="operator">,</span> <span class="float">20.0</span><span class="structure">);</span><br />&nbsp;&nbsp;<span class="word">glMatrixMode</span><span class="structure">(</span><span class="word">GL_MODELVIEW</span><span class="structure">);</span><br />&nbsp;&nbsp;<span class="word">glViewport</span><span class="structure">(</span><span class="number">0</span><span class="operator">,</span> <span class="number">0</span><span class="operator">,</span> <span class="symbol">$x</span><span class="operator">,</span> <span class="symbol">$y</span><span class="structure">);</span><br /><span class="structure">}</span><br /><br /><span class="word">glutDisplayFunc</span><span class="structure">(</span><span class="cast">\</span><span class="symbol">&amp;display</span><span class="structure">);</span><br /><span class="word">glutIdleFunc</span><span class="structure">(</span><span class="cast">\</span><span class="symbol">&amp;idle</span><span class="structure">);</span><br /><span class="word">glutReshapeFunc</span><span class="structure">(</span><span class="cast">\</span><span class="symbol">&amp;reshape</span><span class="structure">);</span><br /><span class="word">glutMainLoop</span><span class="structure">();</span></code><br />&nbsp;</td></table>

<p>Notice that thanks to the care of <a href="https://metacpan.org/module/FFI::Platypus">FFI::Platypus</a> and a few wrappers in the <code>GLUT</code> module, our main script doesn&#39;t have to know or care that it is using FFI.</p>

<p>I have three pretty snowflakes for the holiday party.</p>

<center><img src="screenshot800.png"/></center>

<p>My coworker android friend Mr. Lore also enjoyed it since it reminded him of his friend The Crystalline Entity.</p>

<h2 id="SEE-ALSO">SEE ALSO</h2>

<ul>

<li><p><a href="https://metacpan.org/module/FFI::Platypus">FFI::Platypus</a></p>

</li>
<li><p><a href="https://metacpan.org/module/FFI::CheckLib">FFI::CheckLib</a></p>

</li>
<li><p><a href="https://metacpan.org/module/FFI::Raw">FFI::Raw</a></p>

</li>
<li><p><a href="https://www.opengl.org/">https://www.opengl.org/</a></p>

</li>
</ul>

</div>

<div id='author'>
<img alt='Gravatar Image' style='vertical-align:middle' src=http://www.gravatar.com/avatar/0640fb1c0a5e82f5a777f2306efcac77?r=g&s=80&d=retro />
This article contributed by: Graham Ollis &lt;plicease@cpan.org&gt;
</div>


<ul id="pager">
    <li class="previous"><a title="Fast CPAN Module Installation" href="2015-12-02.html">Previous</a></li>

    <li class="next"><a title="Help! Rudolf&#39;s Nose Won&#39;t Light Up!" href="2015-12-04.html">Next</a></li>
</ul>
<div style="clear: both"></div>

        </div>

    </div>



</body>
</html>





