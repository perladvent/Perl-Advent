<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <meta http-equiv="Content-Language" content="en" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="WWW::AdventCalendar v1.112" />
    <link rel="alternate" title="Perl Advent Calendar 2013 XML feed" href="atom.xml" type="application/atom+xml" />
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="stylesheet" href="style.css" type="text/css" />
    <link rel="stylesheet" href="2013.css" type="text/css" />
    <title>
Perl Advent Calendar 2013 - 
Advent-based Programming

</title>
</head>
<body>
    <div id="contentwrapper">
        <div id="header">
            <h1><a href="index.html">Perl Advent Calendar 2013</a></h1>
        </div>

        <p id="tagline">2013 twenty four merry days of Perl
         <a class='feed' href="atom.xml">Feed</a>
        </p>

        <div id="content">
          

<h1 class='title'>Advent-based Programming</h1>
<div class='subtitle'>Beam::Emitter - 2013-12-16</div>

<div class='pod'><p>Oh, sorry, seasonal slip of the tongue. I meant <i>Event</i>-based programming. A programming paradigm that is used quite exensively in some languages (hellooo JavaScript), but perhaps slightly less so in Perl. And while we see it used most often for asynchronous tasks &mdash; GUIs, server stuff &mdash; it also offers advantages for more typical settings.</p>

<p>For example, let&#39;s consider a Christmas supper. We can all agree that it&#39;s a task that involves a lot of details. If we were to tackle the task the conventional way, we&#39;d create a master class that would organize everything, orchestrate the activities of everybody in the household, and probably go mad before the end of the evening from the sheer complexity of the affair. Not appealing. Alternatively, we could imitate what generations of families have done to get through such an operation: holler across the room each time something happens or is needed, and let everybody concerned in the crowd deal with it.</p>

<p>As you may suspect, many modules exist to deal with event-based programming. Here, I&#39;ll use <a href="https://metacpan.org/module/Beam::Emitter">Beam::Emitter</a>, a very light-weight <a href="https://metacpan.org/module/Moo">Moo</a>-based system.</p>

<p>As mentioned above, the goal here is to have a very simple core system, and have it broadcast everything that need to be acted upon. So we&#39;ll do just that and create our house, which will act like a (warm and cozy) echo chamber:</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;<br />7:&nbsp;<br />8:&nbsp;<br />9:&nbsp;<br />10:&nbsp;<br />11:&nbsp;<br />12:&nbsp;<br />13:&nbsp;<br />14:&nbsp;<br />15:&nbsp;<br />16:&nbsp;<br />17:&nbsp;<br />18:&nbsp;<br />19:&nbsp;<br />20:&nbsp;<br />21:&nbsp;<br />22:&nbsp;<br />23:&nbsp;<br />24:&nbsp;<br />25:&nbsp;<br />26:&nbsp;<br />27:&nbsp;<br />28:&nbsp;<br />29:&nbsp;<br />30:&nbsp;<br />31:&nbsp;<br />32:&nbsp;<br />33:&nbsp;<br />34:&nbsp;<br />35:&nbsp;<br />36:&nbsp;<br />37:&nbsp;<br />38:&nbsp;<br />39:&nbsp;<br />40:&nbsp;<br />41:&nbsp;<br />42:&nbsp;<br />43:&nbsp;<br />44:&nbsp;<br />45:&nbsp;<br />46:&nbsp;<br />47:&nbsp;<br />48:&nbsp;<br />49:&nbsp;<br />50:&nbsp;<br />51:&nbsp;<br />52:&nbsp;<br />53:&nbsp;<br />54:&nbsp;<br />55:&nbsp;<br />56:&nbsp;<br />57:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="keyword">package</span> <span class="word">XmasSupper</span><span class="structure">;</span><br /><br /><span class="keyword">use</span> <span class="version">5.10.0</span><span class="structure">;</span><br /><br /><span class="keyword">use</span> <span class="pragma">strict</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="pragma">warnings</span><span class="structure">;</span><br /><br /><span class="keyword">use</span> <span class="word">JSON</span> <span class="words">qw/ encode_json /</span><span class="structure">;</span><br /><br /><span class="keyword">use</span> <span class="word">Moose</span><span class="structure">;</span><br /><br /><span class="word">with</span> <span class="single">'Beam::Emitter'</span><span class="structure">;</span><br /><br /><span class="word">has</span> <span class="word">guests</span> <span class="operator">=&gt;</span> <span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">traits</span> <span class="operator">=&gt;</span> <span class="structure">[</span> <span class="single">'Array'</span> <span class="structure">]</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">isa</span> <span class="operator">=&gt;</span> <span class="single">'ArrayRef[Peep]'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">is</span> <span class="operator">=&gt;</span> <span class="single">'ro'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">default</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span> <span class="structure">{</span> <span class="structure">[]</span> <span class="structure">}</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">handles</span> <span class="operator">=&gt;</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">add_guest</span> <span class="operator">=&gt;</span> <span class="single">'push'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">}</span><span class="operator">,</span><br /><span class="structure">);</span><br /><br /><span class="word">has</span> <span class="double">&quot;table&quot;</span> <span class="operator">=&gt;</span> <span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">isa</span> <span class="operator">=&gt;</span> <span class="single">'HashRef'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">is</span> <span class="operator">=&gt;</span> <span class="single">'ro'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">default</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span> <span class="structure">{</span> <span class="structure">{}</span> <span class="structure">}</span><span class="operator">,</span><br /><span class="structure">);</span><br /><br /><span class="comment"># method to invite our guests<br /></span><span class="keyword">sub</span> <span class="word">invite</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">my</span> <span class="symbol">$self</span> <span class="operator">=</span> <span class="core">shift</span><span class="structure">;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span> <span class="structure">(</span> <span class="magic">@_</span> <span class="structure">)</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="magic">$_</span><span class="operator">-&gt;</span><span class="word">supper</span><span class="structure">(</span><span class="symbol">$self</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">add_guest</span><span class="structure">(</span><span class="magic">$_</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="magic">$_</span><span class="operator">-&gt;</span><span class="word">register_events</span><span class="structure">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">}</span><br /><span class="structure">}</span><br /><br /><span class="comment"># the events of the evening<br /></span><br /><span class="keyword">sub</span> <span class="word">prepare</span> <span class="structure">{</span> <span class="magic">$_</span><span class="structure">[</span><span class="number">0</span><span class="structure">]</span><span class="operator">-&gt;</span><span class="word">emit</span><span class="structure">(</span><span class="single">'prepare'</span><span class="structure">)</span> <span class="structure">}</span><br /><br /><span class="keyword">sub</span> <span class="word">serve</span> <span class="structure">{</span> <span class="magic">$_</span><span class="structure">[</span><span class="number">0</span><span class="structure">]</span><span class="operator">-&gt;</span><span class="word">emit</span><span class="structure">(</span><span class="double">&quot;supper's ready&quot;</span><span class="structure">)</span> <span class="structure">}</span><br /><br /><span class="keyword">sub</span> <span class="word">eat</span> <span class="structure">{</span> <span class="magic">$_</span><span class="structure">[</span><span class="number">0</span><span class="structure">]</span><span class="operator">-&gt;</span><span class="word">emit</span><span class="structure">(</span><span class="double">&quot;eat&quot;</span><span class="structure">)</span> <span class="structure">}</span><br /><br /><span class="keyword">sub</span> <span class="word">done</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">my</span> <span class="symbol">$self</span> <span class="operator">=</span> <span class="core">shift</span><span class="structure">;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">say</span> <span class="double">&quot;leftovers: &quot;</span><span class="operator">,</span> <span class="word">encode_json</span><span class="structure">(</span> <span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">table</span> <span class="structure">);</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">emit</span><span class="structure">(</span> <span class="single">'all done'</span> <span class="structure">);</span><br /><span class="structure">}</span><br /><br /><span class="number">1</span><span class="structure">;</span></code><br />&nbsp;</td></table>

<p>All the magic of the party will reside in its guests (but then, isn&#39;t that always the case?). Each person invited, via <code>$_-&gt;register_events</code> is invited to keep their ears open for things that pertain to them. So what we need to have their class implement is that listening, and of course whatever they have to do when the stuff happens.</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;<br />7:&nbsp;<br />8:&nbsp;<br />9:&nbsp;<br />10:&nbsp;<br />11:&nbsp;<br />12:&nbsp;<br />13:&nbsp;<br />14:&nbsp;<br />15:&nbsp;<br />16:&nbsp;<br />17:&nbsp;<br />18:&nbsp;<br />19:&nbsp;<br />20:&nbsp;<br />21:&nbsp;<br />22:&nbsp;<br />23:&nbsp;<br />24:&nbsp;<br />25:&nbsp;<br />26:&nbsp;<br />27:&nbsp;<br />28:&nbsp;<br />29:&nbsp;<br />30:&nbsp;<br />31:&nbsp;<br />32:&nbsp;<br />33:&nbsp;<br />34:&nbsp;<br />35:&nbsp;<br />36:&nbsp;<br />37:&nbsp;<br />38:&nbsp;<br />39:&nbsp;<br />40:&nbsp;<br />41:&nbsp;<br />42:&nbsp;<br />43:&nbsp;<br />44:&nbsp;<br />45:&nbsp;<br />46:&nbsp;<br />47:&nbsp;<br />48:&nbsp;<br />49:&nbsp;<br />50:&nbsp;<br />51:&nbsp;<br />52:&nbsp;<br />53:&nbsp;<br />54:&nbsp;<br />55:&nbsp;<br />56:&nbsp;<br />57:&nbsp;<br />58:&nbsp;<br />59:&nbsp;<br />60:&nbsp;<br />61:&nbsp;<br />62:&nbsp;<br />63:&nbsp;<br />64:&nbsp;<br />65:&nbsp;<br />66:&nbsp;<br />67:&nbsp;<br />68:&nbsp;<br />69:&nbsp;<br />70:&nbsp;<br />71:&nbsp;<br />72:&nbsp;<br />73:&nbsp;<br />74:&nbsp;<br />75:&nbsp;<br />76:&nbsp;<br />77:&nbsp;<br />78:&nbsp;<br />79:&nbsp;<br />80:&nbsp;<br />81:&nbsp;<br />82:&nbsp;<br />83:&nbsp;<br />84:&nbsp;<br />85:&nbsp;<br />86:&nbsp;<br />87:&nbsp;<br />88:&nbsp;<br />89:&nbsp;<br />90:&nbsp;<br />91:&nbsp;<br />92:&nbsp;<br />93:&nbsp;<br />94:&nbsp;<br />95:&nbsp;<br />96:&nbsp;<br />97:&nbsp;<br />98:&nbsp;<br />99:&nbsp;<br />100:&nbsp;<br />101:&nbsp;<br />102:&nbsp;<br />103:&nbsp;<br />104:&nbsp;<br />105:&nbsp;<br />106:&nbsp;<br />107:&nbsp;<br />108:&nbsp;<br />109:&nbsp;<br />110:&nbsp;<br />111:&nbsp;<br />112:&nbsp;<br />113:&nbsp;<br />114:&nbsp;<br />115:&nbsp;<br />116:&nbsp;<br />117:&nbsp;<br />118:&nbsp;<br />119:&nbsp;<br />120:&nbsp;<br />121:&nbsp;<br />122:&nbsp;<br />123:&nbsp;<br />124:&nbsp;<br />125:&nbsp;<br />126:&nbsp;<br />127:&nbsp;<br />128:&nbsp;<br />129:&nbsp;<br />130:&nbsp;<br />131:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="keyword">package</span> <span class="word">Peep</span><span class="structure">;</span><br /><br /><span class="keyword">use</span> <span class="version">5.10.0</span><span class="structure">;</span><br /><br /><span class="keyword">use</span> <span class="pragma">strict</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="pragma">warnings</span><span class="structure">;</span><br /><br /><span class="keyword">use</span> <span class="word">JSON</span> <span class="words">qw/ encode_json /</span><span class="structure">;</span><br /><br /><span class="keyword">use</span> <span class="word">Moose</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="word">Moose::Util</span> <span class="words">qw/ apply_all_roles /</span><span class="structure">;</span><br /><br /><span class="word">has</span> <span class="word">name</span> <span class="operator">=&gt;</span> <span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">isa</span> <span class="operator">=&gt;</span> <span class="single">'Str'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">is</span>  <span class="operator">=&gt;</span> <span class="single">'ro'</span><span class="operator">,</span><br /><span class="structure">);</span><br /><br /><span class="word">has</span> <span class="double">&quot;supper&quot;</span> <span class="operator">=&gt;</span> <span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">isa</span> <span class="operator">=&gt;</span> <span class="single">'XmasSupper'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">is</span> <span class="operator">=&gt;</span> <span class="single">'rw'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">handles</span> <span class="operator">=&gt;</span> <span class="structure">[</span> <span class="single">'emit'</span><span class="operator">,</span> <span class="single">'on'</span><span class="operator">,</span> <span class="single">'table'</span> <span class="structure">]</span><span class="operator">,</span><br /><span class="structure">);</span><br /><br /><br /><span class="comment"># can be trusted with the turkey?<br /></span><span class="word">has</span> <span class="word">is_cook</span> <span class="operator">=&gt;</span> <span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">isa</span>     <span class="operator">=&gt;</span> <span class="single">'Bool'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">is</span>      <span class="operator">=&gt;</span> <span class="single">'ro'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">default</span> <span class="operator">=&gt;</span> <span class="number">0</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">trigger</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">my</span> <span class="symbol">$self</span> <span class="operator">=</span> <span class="core">shift</span><span class="structure">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">apply_all_roles</span><span class="structure">(</span> <span class="symbol">$self</span><span class="operator">,</span> <span class="single">'Cook'</span> <span class="structure">)</span> <span class="word">if</span> <span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">is_cook</span><span class="structure">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">}</span><span class="operator">,</span><br /><span class="structure">);</span><br /><br /><span class="comment"># prefer white or dark meat?<br /></span><span class="word">has</span> <span class="word">turkey_preference</span> <span class="operator">=&gt;</span> <span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">isa</span>       <span class="operator">=&gt;</span> <span class="single">'Str'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">is</span>        <span class="operator">=&gt;</span> <span class="single">'ro'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">predicate</span> <span class="operator">=&gt;</span> <span class="single">'has_turkey_preference'</span><span class="operator">,</span><br /><span class="structure">);</span><br /><br /><span class="comment"># prefered trimmings?<br /></span><span class="word">has</span> <span class="word">trimmings</span> <span class="operator">=&gt;</span> <span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">traits</span>  <span class="operator">=&gt;</span> <span class="structure">[</span> <span class="single">'Array'</span> <span class="structure">]</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">isa</span>     <span class="operator">=&gt;</span> <span class="single">'ArrayRef[Str]'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">is</span>      <span class="operator">=&gt;</span> <span class="single">'ro'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">default</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span> <span class="structure">{</span> <span class="structure">[]</span> <span class="structure">}</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">handles</span> <span class="operator">=&gt;</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">all_trimmings</span> <span class="operator">=&gt;</span> <span class="single">'elements'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">}</span><span class="operator">,</span><br /><span class="structure">);</span><br /><br /><span class="comment"># helping or just chillin' in the living room?<br /></span><span class="word">has</span> <span class="word">is_busy</span> <span class="operator">=&gt;</span> <span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">isa</span>     <span class="operator">=&gt;</span> <span class="single">'Bool'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">is</span>      <span class="operator">=&gt;</span> <span class="single">'rw'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">default</span> <span class="operator">=&gt;</span> <span class="number">0</span><span class="operator">,</span><br /><span class="structure">);</span><br /><br /><span class="word">has</span> <span class="word">plate</span> <span class="operator">=&gt;</span> <span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">isa</span> <span class="operator">=&gt;</span> <span class="single">'HashRef'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">is</span> <span class="operator">=&gt;</span> <span class="single">'ro'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">default</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span> <span class="structure">{</span> <span class="structure">{}</span> <span class="structure">}</span><span class="operator">,</span><br /><span class="structure">);</span><br /><br /><span class="comment"># keep an ear out for stuff we can do<br /></span><span class="keyword">sub</span> <span class="word">register_events</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">my</span> <span class="symbol">$self</span> <span class="operator">=</span> <span class="core">shift</span><span class="structure">;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">supper</span><span class="operator">-&gt;</span><span class="word">on</span><span class="structure">(</span> <span class="single">'need fixing'</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> <span class="word">if</span> <span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">is_busy</span><span class="structure">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">prepare_fixing</span><span class="structure">(</span><span class="core">shift</span><span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">}</span> <span class="structure">);</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">supper</span><span class="operator">-&gt;</span><span class="word">on</span><span class="structure">(</span> <span class="double">&quot;supper's ready&quot;</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">fill_plate</span><span class="structure">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">});</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">supper</span><span class="operator">-&gt;</span><span class="word">on</span><span class="structure">(</span> <span class="double">&quot;eat&quot;</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">eat</span><span class="structure">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">});</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">supper</span><span class="operator">-&gt;</span><span class="word">on</span><span class="structure">(</span> <span class="single">'all done'</span><span class="operator">,</span> <span class="keyword">sub</span> <span class="structure">{</span> <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">say</span><span class="structure">(</span> <span class="single">'God bless us, every one!'</span> <span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">}</span> <span class="structure">)</span> <span class="word">if</span> <span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">name</span> <span class="operator">eq</span> <span class="single">'Timothy'</span><span class="structure">;</span><br /><br /><span class="structure">}</span><br /><br /><span class="comment"># ... and the stuff we can, and will, do<br /></span><br /><span class="keyword">sub</span> <span class="word">prepare_fixing</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">my</span><span class="structure">(</span> <span class="symbol">$self</span><span class="operator">,</span> <span class="symbol">$fixing</span> <span class="structure">)</span> <span class="operator">=</span> <span class="magic">@_</span><span class="structure">;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">is_busy</span><span class="structure">(</span><span class="number">1</span><span class="structure">);</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">say</span><span class="structure">(</span> <span class="double">&quot;preparing the &quot;</span><span class="operator">,</span> <span class="symbol">$fixing</span><span class="operator">-&gt;</span><span class="word">type</span> <span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">table</span><span class="operator">-&gt;</span><span class="structure">{</span><span class="word">fixing</span><span class="structure">}{</span><span class="symbol">$fixing</span><span class="operator">-&gt;</span><span class="word">type</span><span class="structure">}</span> <span class="operator">=</span> <span class="number">2</span><span class="structure">;</span><br /><br /><span class="comment">    # somebody's on it, can stop calling for help<br /></span>    <span class="symbol">$fixing</span><span class="operator">-&gt;</span><span class="word">stop</span><span class="structure">;</span><br /><span class="structure">}</span><br /><br /><span class="keyword">sub</span> <span class="word">fill_plate</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">my</span> <span class="symbol">$self</span> <span class="operator">=</span> <span class="core">shift</span><span class="structure">;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">for</span> <span class="structure">(</span> <span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">all_trimmings</span> <span class="structure">)</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span> <span class="structure">(</span> <span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">table</span><span class="operator">-&gt;</span><span class="structure">{</span><span class="word">fixing</span><span class="structure">}{</span><span class="magic">$_</span><span class="structure">}</span> <span class="structure">)</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">table</span><span class="operator">-&gt;</span><span class="structure">{</span><span class="word">fixing</span><span class="structure">}{</span><span class="magic">$_</span><span class="structure">}</span><span class="operator">--</span><span class="structure">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">plate</span><span class="operator">-&gt;</span><span class="structure">{</span><span class="word">fixing</span><span class="structure">}{</span><span class="magic">$_</span><span class="structure">}</span><span class="operator">++</span><span class="structure">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">say</span><span class="structure">(</span> <span class="double">&quot;no more &quot;</span><span class="operator">,</span> <span class="magic">$_</span> <span class="structure">);</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">}</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">}</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">plate</span><span class="operator">-&gt;</span><span class="structure">{</span><span class="word">turkey</span><span class="structure">}</span> <span class="operator">=</span> <span class="number">1</span><span class="structure">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">table</span><span class="operator">-&gt;</span><span class="structure">{</span><span class="word">turkey</span><span class="structure">}{</span><span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">turkey_preference</span><span class="structure">}</span><span class="operator">--</span><span class="structure">;</span><br /><span class="structure">}</span><br /><br /><span class="keyword">sub</span> <span class="word">eat</span> <span class="structure">{</span> <br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">my</span> <span class="symbol">$self</span> <span class="operator">=</span> <span class="core">shift</span><span class="structure">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">say</span><span class="structure">(</span> <span class="single">'O NOM NOM NOM'</span><span class="operator">,</span> <span class="double">&quot;\n&quot;</span><span class="operator">,</span> <span class="word">encode_json</span><span class="structure">(</span> <span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">plate</span> <span class="structure">)</span> <span class="structure">);</span><br /><span class="structure">}</span><br /><br /><span class="keyword">sub</span> <span class="word">say</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">my</span> <span class="symbol">$self</span> <span class="operator">=</span> <span class="core">shift</span><span class="structure">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">say</span> <span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">name</span><span class="operator">,</span> <span class="double">&quot;: &quot;</span><span class="operator">,</span> <span class="magic">@_</span><span class="structure">;</span><br /><span class="structure">}</span><br /><br /><span class="number">1</span><span class="structure">;</span></code><br />&nbsp;</td></table>

<p>The system is very flexible. Have some events only some people can act on? No problem, just have those special ones listen to the events. For example, only a bona fide cook should be trusted with taking control of the kitchen:</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;<br />7:&nbsp;<br />8:&nbsp;<br />9:&nbsp;<br />10:&nbsp;<br />11:&nbsp;<br />12:&nbsp;<br />13:&nbsp;<br />14:&nbsp;<br />15:&nbsp;<br />16:&nbsp;<br />17:&nbsp;<br />18:&nbsp;<br />19:&nbsp;<br />20:&nbsp;<br />21:&nbsp;<br />22:&nbsp;<br />23:&nbsp;<br />24:&nbsp;<br />25:&nbsp;<br />26:&nbsp;<br />27:&nbsp;<br />28:&nbsp;<br />29:&nbsp;<br />30:&nbsp;<br />31:&nbsp;<br />32:&nbsp;<br />33:&nbsp;<br />34:&nbsp;<br />35:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="keyword">package</span> <span class="word">Cook</span><span class="structure">;</span><br /><br /><span class="keyword">use</span> <span class="pragma">strict</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="pragma">warnings</span><span class="structure">;</span><br /><br /><span class="keyword">use</span> <span class="word">Trimming</span><span class="structure">;</span><br /><br /><span class="keyword">use</span> <span class="word">Moose::Role</span><span class="structure">;</span><br /><br /><span class="word">after</span> <span class="single">'register_events'</span> <span class="operator">=&gt;</span> <span class="keyword">sub</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">my</span> <span class="symbol">$self</span> <span class="operator">=</span> <span class="core">shift</span><span class="structure">;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">on</span><span class="structure">(</span> <span class="single">'prepare'</span><span class="operator">,</span> <span class="keyword">sub</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">prepare_supper</span><span class="structure">;</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">});</span><br /><span class="structure">};</span><br /><br /><span class="keyword">sub</span> <span class="word">prepare_supper</span> <span class="structure">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">my</span> <span class="symbol">$self</span> <span class="operator">=</span> <span class="core">shift</span><span class="structure">;</span><br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">is_busy</span><span class="structure">(</span><span class="number">1</span><span class="structure">);</span><br /><br /><span class="comment">    # needs help with the fixings<br /></span>    <span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">emit</span><span class="structure">(</span> <span class="single">'need fixing'</span><span class="operator">,</span> <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">class</span> <span class="operator">=&gt;</span> <span class="single">'Trimming'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">type</span> <span class="operator">=&gt;</span> <span class="magic">$_</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">)</span> <span class="word">for</span> <span class="words">qw/ potatoes pickles gravy /</span><span class="structure">;</span><br /><br /><span class="comment">    # prepare the turkey<br /></span>    <span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">table</span><span class="operator">-&gt;</span><span class="structure">{</span> <span class="word">turkey</span> <span class="structure">}</span> <span class="operator">=</span> <span class="structure">{</span> <span class="word">white</span> <span class="operator">=&gt;</span> <span class="single">'4'</span><span class="operator">,</span> <span class="word">dark</span> <span class="operator">=&gt;</span> <span class="single">'4'</span> <span class="structure">};</span> <br /><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="symbol">$self</span><span class="operator">-&gt;</span><span class="word">say</span><span class="structure">(</span> <span class="double">&quot;turkey's done&quot;</span> <span class="structure">);</span><br /><span class="structure">}</span><br /><br /><span class="number">1</span><span class="structure">;</span></code><br />&nbsp;</td></table>

<p>Need to pass on some additional information with an event, like what type of trimming needs to be attended to? With <i>Beam::Emitter</i>, the events are passed objects, so you can create a a sub-class containing the data you want and it&#39;s all good:</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;<br />7:&nbsp;<br />8:&nbsp;<br />9:&nbsp;<br />10:&nbsp;<br />11:&nbsp;<br />12:&nbsp;<br />13:&nbsp;<br />14:&nbsp;<br />15:&nbsp;<br />16:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="keyword">package</span> <span class="word">Trimming</span><span class="structure">;</span><br /><br /><span class="keyword">use</span> <span class="pragma">strict</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="pragma">warnings</span><span class="structure">;</span><br /><br /><span class="keyword">use</span> <span class="word">Moose</span><span class="structure">;</span><br /><br /><span class="word">extends</span> <span class="single">'Beam::Event'</span><span class="structure">;</span><br /><br /><span class="word">has</span> <span class="double">&quot;type&quot;</span> <span class="operator">=&gt;</span> <span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">isa</span>      <span class="operator">=&gt;</span> <span class="single">'Str'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">is</span>       <span class="operator">=&gt;</span> <span class="single">'ro'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">required</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">,</span><br /><span class="structure">);</span><br /><br /><span class="number">1</span><span class="structure">;</span></code><br />&nbsp;</td></table>

<p>And with that... believe it or not, you&#39;re all set to go. Well, almost. We still have to send our invitations and launch the festivities:</p>

<table class='code-listing'><tr><td class='line-numbers'><br /><code>1:&nbsp;<br />2:&nbsp;<br />3:&nbsp;<br />4:&nbsp;<br />5:&nbsp;<br />6:&nbsp;<br />7:&nbsp;<br />8:&nbsp;<br />9:&nbsp;<br />10:&nbsp;<br />11:&nbsp;<br />12:&nbsp;<br />13:&nbsp;<br />14:&nbsp;<br />15:&nbsp;<br />16:&nbsp;<br />17:&nbsp;<br />18:&nbsp;<br />19:&nbsp;<br />20:&nbsp;<br />21:&nbsp;<br />22:&nbsp;<br />23:&nbsp;<br />24:&nbsp;<br />25:&nbsp;<br />26:&nbsp;<br />27:&nbsp;<br />28:&nbsp;<br />29:&nbsp;<br />30:&nbsp;<br />31:&nbsp;<br />32:&nbsp;<br />33:&nbsp;<br />34:&nbsp;<br />35:&nbsp;<br />36:&nbsp;<br />37:&nbsp;<br />38:&nbsp;<br />39:&nbsp;<br />40:&nbsp;<br />41:&nbsp;<br />42:&nbsp;<br />43:&nbsp;<br />44:&nbsp;<br />45:&nbsp;<br />46:&nbsp;<br />47:&nbsp;<br />48:&nbsp;<br />49:&nbsp;<br />50:&nbsp;</code><br />&nbsp;</td><td class='code'><br /><code><span class="comment"># supper.pl<br /></span><br /><span class="keyword">use</span> <span class="pragma">strict</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="pragma">warnings</span><span class="structure">;</span><br /><br /><span class="keyword">use</span> <span class="word">XmasSupper</span><span class="structure">;</span><br /><span class="keyword">use</span> <span class="word">Peep</span><span class="structure">;</span><br /><br /><span class="keyword">my</span> <span class="symbol">$supper</span> <span class="operator">=</span> <span class="word">XmasSupper</span><span class="operator">-&gt;</span><span class="word">new</span><span class="structure">;</span><br /><br /><span class="symbol">$supper</span><span class="operator">-&gt;</span><span class="word">invite</span><span class="structure">(</span> <span class="magic">$_</span> <span class="structure">)</span> <span class="word">for</span> <br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">Peep</span><span class="operator">-&gt;</span><span class="word">new</span><span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">name</span>              <span class="operator">=&gt;</span> <span class="single">'Mrs. Cratchit'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">is_cook</span>           <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">turkey_preference</span> <span class="operator">=&gt;</span> <span class="single">'white'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">trimmings</span>         <span class="operator">=&gt;</span> <span class="structure">[</span> <span class="single">'gravy'</span><span class="operator">,</span> <span class="single">'potatoes'</span> <span class="structure">]</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">)</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">Peep</span><span class="operator">-&gt;</span><span class="word">new</span><span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">name</span>              <span class="operator">=&gt;</span> <span class="single">'Bob'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">turkey_preference</span> <span class="operator">=&gt;</span> <span class="single">'dark'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">trimmings</span>         <span class="operator">=&gt;</span> <span class="structure">[</span> <span class="single">'gravy'</span><span class="operator">,</span> <span class="single">'potatoes'</span><span class="operator">,</span> <span class="single">'pickles'</span> <span class="structure">]</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">)</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">Peep</span><span class="operator">-&gt;</span><span class="word">new</span><span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">name</span>              <span class="operator">=&gt;</span> <span class="single">'Timothy'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">turkey_preference</span> <span class="operator">=&gt;</span> <span class="single">'dark'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">trimmings</span>         <span class="operator">=&gt;</span> <span class="structure">[</span> <span class="single">'gravy'</span><span class="operator">,</span> <span class="single">'pickles'</span> <span class="structure">]</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">)</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">Peep</span><span class="operator">-&gt;</span><span class="word">new</span><span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">name</span>              <span class="operator">=&gt;</span> <span class="single">'Martha'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">turkey_preference</span> <span class="operator">=&gt;</span> <span class="single">'dark'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">trimmings</span>         <span class="operator">=&gt;</span> <span class="structure">[</span> <span class="single">'potatoes'</span><span class="operator">,</span> <span class="single">'pickles'</span> <span class="structure">]</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">)</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">Peep</span><span class="operator">-&gt;</span><span class="word">new</span><span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">name</span>              <span class="operator">=&gt;</span> <span class="single">'Peter'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">turkey_preference</span> <span class="operator">=&gt;</span> <span class="single">'white'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">trimmings</span>         <span class="operator">=&gt;</span> <span class="structure">[</span> <span class="single">'pickles'</span> <span class="structure">]</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">)</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">Peep</span><span class="operator">-&gt;</span><span class="word">new</span><span class="structure">(</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">name</span>              <span class="operator">=&gt;</span> <span class="single">'Bilinda'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">turkey_preference</span> <span class="operator">=&gt;</span> <span class="single">'white'</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="word">trimmings</span>         <span class="operator">=&gt;</span> <span class="structure">[</span> <span class="single">'gravy'</span> <span class="structure">]</span><span class="operator">,</span><br />&nbsp;&nbsp;&nbsp;&nbsp;<span class="structure">);</span><br /><br /><span class="symbol">$supper</span><span class="operator">-&gt;</span><span class="word">prepare</span><span class="structure">;</span><br /><br /><span class="symbol">$supper</span><span class="operator">-&gt;</span><span class="word">serve</span><span class="structure">;</span><br /><br /><span class="symbol">$supper</span><span class="operator">-&gt;</span><span class="word">eat</span><span class="structure">;</span><br /><br /><span class="symbol">$supper</span><span class="operator">-&gt;</span><span class="word">done</span><span class="structure">;</span></code><br />&nbsp;</td></table>

<p>And then... lo and behold:</p>

<pre><code>    $ perl supper.pl 

    Bob: preparing the potatoes
    Timothy: preparing the pickles
    Martha: preparing the gravy
    Mrs. Cratchit: turkey&#39;s done

    Timothy: no more gravy
    Martha: no more potatoes
    Martha: no more pickles
    Peter: no more pickles
    Bilinda: no more gravy

    Mrs. Cratchit: O NOM NOM NOM
    {&quot;turkey&quot;:1,&quot;fixing&quot;:{&quot;gravy&quot;:1,&quot;potatoes&quot;:1}}
    Bob: O NOM NOM NOM
    {&quot;turkey&quot;:1,&quot;fixing&quot;:{&quot;pickles&quot;:1,&quot;gravy&quot;:1,&quot;potatoes&quot;:1}}
    Timothy: O NOM NOM NOM
    {&quot;turkey&quot;:1,&quot;fixing&quot;:{&quot;pickles&quot;:1}}
    Martha: O NOM NOM NOM
    {&quot;turkey&quot;:1}
    Peter: O NOM NOM NOM
    {&quot;turkey&quot;:1}
    Bilinda: O NOM NOM NOM
    {&quot;turkey&quot;:1}

    leftovers: {&quot;turkey&quot;:{&quot;white&quot;:1,&quot;dark&quot;:1},&quot;fixing&quot;:{&quot;gravy&quot;:0,&quot;pickles&quot;:0,&quot;potatoes&quot;:0}}
    Timothy: God bless us, every one!</code></pre>

<h2 id="See-Also">See Also</h2>

<ul>

<li><p><a href="https://metacpan.org/module/Beam::Emitter">Beam::Emitter</a></p>

</li>
</ul>

</div>

<div id='author'>
<img alt='Gravatar Image' style='vertical-align:middle' src=http://www.gravatar.com/avatar/2121b9ebc49fa7f8122e971628f04261?r=g&s=80&d=retro />
This article contributed by: Yanick Champoux &lt;yanick@cpan.org&gt;
</div>


<ul id="pager">
    <li class="previous"><a title="Got Git? Ask Santa to get Got!" href="2013-12-15.html">Previous</a></li>

    <li class="next"><a title="How many days until Christmas?" href="2013-12-17.html">Next</a></li>
</ul>
<div style="clear: both"></div>

        </div>

    </div>



</body>
</html>





